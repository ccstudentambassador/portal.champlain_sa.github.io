<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Ambassador Homepage</title>
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.2.0/css/mdb.min.css" media="screen" title="no title">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" media="screen" title="no title">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="styles/styles.css" media="screen" title="no title">
    <link rel="stylesheet" href="styles/sidebar.css" media="screen" title="no title">
  </head>
  <body>
    <nav>
      <!-- <img src="logo_color.png" alt="" /> -->
      <a id="logo-wrapper" href="index.html">
        <div class="logo">
          <span>STUD</span>
          <span>ENT &nbsp;</span>
        </div>
        <div class="logo">
          <span>AMBASSADORS</span>
        </div>
      </a>

      <div class="pages">
        <a href="index.html"><li>Home</li></a>
        <a href="./pages/extensions.html"><li>Extensions</li></a>
        <a href="./pages/counselormap.html"><li>Counselor Map</li></a>
      </div>
    </nav>

    <div class="sidebar">
      <img src="images/shield_color.png" alt=""/>
    </div>

    <div class="wrapper">
      <div class="news">
        <h1>Office Updates &amp; News <a href="https://goo.gl/forms/V52CgIlcoV4C9z5j1" target="_blank"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a></h1>
        <div class="items"></div>
      </div>
      <!-- TODO  -->
      <!-- Workday -->
      <div class="events-upcoming">
        <iframe src="https://calendar.google.com/calendar/embed?src=champlain.edu_n4tc14h37mq03qj9vnhqinue90%40group.calendar.google.com&ctz=America/New_York" style="border: 0" width="800" height="600" frameborder="0" scrolling="no"></iframe>
      </div>
    </div>
    <!-- <footer>
      <div id="champlain">
        <img src="images/shield_color.png" alt=""/>
        <span>LET US DARE</span>
      </div>
      <span id="footer-background"></span>
    </footer> -->

    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="./assets/timeago.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.2.0/js/mdb.min.js" charset="utf-8"></script>
    <script src="./assets/tabletop.js" charset="utf-8"></script>
    <script src="./assets/format-google-calendar.js" charset="utf-8"></script>
    <script type="text/javascript">
      $( document ).ready(function() {
        // Intialize Updates Board
        init();

        $("#secret").hide();

        // Set up incognito clicks
        $("#coverage").click(function(event) {
          event.preventDefault();
          incognitoShake($(this));
        });
        $("#feedback").click(function(event) {
          event.preventDefault();
          incognitoShake($(this));
        });
        $("#workday").click(function(event) {
          event.preventDefault();
          incognitoShake($(this));
        });
      });

      var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/1VPJsWRqeBW6t7xn3JphKra1LwrmyJpstcjhJz0tTyDk/pubhtml';

      function init() {
        Tabletop.init( { key: public_spreadsheet_url,
                         callback: showInfo,
                         simpleSheet: true } )
      }

      var monthNames = [
        "January", "February", "March",
        "April", "May", "June", "July",
        "August", "September", "October",
        "November", "December"
      ];

      function showInfo(data, tabletop) {
        $(".news .items").empty();
        if (data.length == 0){
          $(".news .items").append("<h3> No updates at this time </h3>").css("overflow-y", "hidden");
        } else {
          $(".news .items").css("overflow-y", "auto");
          var i;
          var today = new Date();
          data.reverse().forEach(function(update){
            var date = new Date(update.Timestamp);
            var timeDiff = Math.abs(today.getTime() - date.getTime());
            var diffDays = Math.floor(timeDiff / (1000 * 3600 * 24)) + 1;
            if (diffDays <= 14)
            {
              $(".news .items").append(
                '<tr class="item"> <td class="date">' + monthNames[date.getMonth()] + ' ' + date.getDate() + ': <br> <span style="color: #969696; font-size: 15px;"> (' + $.timeago(date.getTime()) + ') </span> ' + '</td> <td class="message">' + update.Message + '</td> </tr>'
              );
            }
          });
        }
        setTimeout(function(){
          init();
        }, 10000);
      }

      function isMobile(){
        return ($(".news").css("display") == "none") ? true : false;
      }

      function incognitoShake(element){
        var text = isMobile() ? "HOLD → Open In Incognito" : "RIGHT CLICK → Open In Incognito";
        var size = isMobile() ? "30px" : "";
        var link = element.find("span").text();
        element.css("background-color", "#EE3124");
        element.find("span").css("font-size", size);
        element.addClass("animated shake");
        element.find("i").hide();
        element.find("img").hide();
        element.find("#secret").show();
        element.find("span").text(text);
        setTimeout(function(){
          element.css("background-color", "#00aeef");
          element.find("span").css("font-size", "");
          element.removeClass("animated shake");
          element.find("i").show();
          element.find("img").show();
          element.find("#secret").hide();
          element.find("span").text(link);
        }, 5000);
      }
    </script>
  </body>
</html>
